model_name: cross_db_mil_coral

# Shared Settings
num_classes: 5
# input_dim: 768 
# input_dim: 288      # Ensure all datasets have this feature dimension!
embed_dim: 256
attn_type: simple
xformer_heads: 4
xformer_latents: 16
xformer_dropout: 0.3

# Optimization
learning_rate: 1e-4
weight_decay: 1e-2
batch_size: 32
max_epochs: 50
monitor_metric: val_acc
accelerator: gpu
devices: 1

# Loss & Heads
coral_alpha: 0.5
ce_weight: 1.0
eval_head: ce

# Auxiliary Task (BioVid)
aux_loss_weight: 0.001
aux_num_classes: 5
aux_dataset:
  enabled: true
  dataset_name: biovid
  feature_name: openface_au_288
  # dataset_name: biovid
  meta_path: /data/Nbi/biovid/biovid_pain_labels.csv
  # # feature_root: /data/Nbi/biovid/MMA_random_features_new/
  # # feature_root: /data/Nbi/biovid/MMA_RGB_features_new/
  # # feature_root: /data/Nbi/biovid/marlin_rgb_features/
  # feature_root: /data/Nbi/biovid/openface_au/features/
  # feature_suffix: _windows.npy
  # feature_suffix: _aligned_windows.npy
  label_col: pain_level
  video_col: video_id

# Cutoffs Strategy
# Base cutoffs for 0-10 scale (Syracuse)
# 0-5 scale datasets will use [c/2 for c in these] automatically
pain_class_cutoffs: [1.1, 3.1, 5.1, 7.1]

# Experiment Definition
# Which datasets to use for TRAINING (Source)
train_sources:
  - shoulder_pain

# Which datasets to use for TESTING (Targets)
# The script will iterate through these after training
test_targets:
  - syracuse
  # - unbc_mcmaster (Add more here)

# Target-domain validation split (NO overlap with test)
# We split ONE target dataset into val/test subsets; val is used for early stopping.
val_target: shoulder_pain
val_ratio: 0.2              # 20% subjects (or samples) as val
val_split_strategy: subject # subject | random
val_seed: 42

# Datasets Pool
# Optional: centralized feature registry (dataset Ã— feature paths/suffix/prefix)
# If provided, each dataset can specify `feature_name` instead of hardcoding feature_root/suffix/prefix here.
feature_catalog_path: /data/Nbi/Marlin/MARLIN/config/feature_catalog.yaml

datasets:
  syracuse:
    scale: "0-10"
    meta_path: /data/Nbi/Syracuse/meta_with_outcomes.xlsx
    # feature_root: /data/Nbi/Syracuse/syracuse_random_features/RGB/
    # feature_suffix: _windows.npy
    # feature_root: /data/Nbi/Syracuse/syracuse_marlin_rgb_features/RGB/
    # feature_suffix: _aligned_windows.npy
    # feature_root: /data/Nbi/Syracuse/syracuse_fixed_combo_features/RGB/
    # feature_suffix: _windows.npy
    # Option A: use feature registry
    feature_name: openface_au_288
    # Option B (override): explicitly set root/suffix/prefix here
    # feature_root: /data/Nbi/Syracuse/AU_from_openface/RGB/
    # feature_suffix: _windows.npy
    label_col: pain_level
    video_col: file_name
    subject_col: subject_id
    remove_extension: true # Handle IMG_0049.MP4 -> IMG_0049

  shoulder_pain:
    scale: "0-10"
    meta_path: /data/Nbi/ShoulderPain/pain_scores.csv
    # feature_prefix: "IMG_"  # Example usage: adds prefix to video_id

    # feature_root: /data/Nbi/ShoulderPain/mma_random_features/
    # feature_suffix: _windows.npy
    # feature_root: /data/Nbi/ShoulderPain/marlin_rgb_features/
    # feature_suffix: _aligned_windows.npy
    # feature_root: /data/Nbi/ShoulderPain/mma_rgb_features/ 
    # feature_suffix: _windows.npy
    feature_name: openface_au_288
    # feature_root: /data/Nbi/ShoulderPain/openface_features/ 
    # feature_suffix: _windows.npy

    label_col: VAS
    video_col: Video
    subject_col: patient_id

    
  hospital_pain:
    scale: "0-10"
    meta_path: /data/Nbi/HospitalPain/pain_scores.csv
    feature_name: marlin_rgb_768_aligned
    # feature_root: /data/Nbi/HospitalPain/marlin_rgb_features/
    # feature_suffix: _aligned_windows.npy
    feature_prefix: "IMG_"  # Example usage: adds prefix to video_id
    label_col: VAS
    video_col: Video
    subject_col: patient_id
  # unbc_mcmaster:
  #   scale: "0-5"
  #   ...
monitor_metric: val_acc
save_dir: CrossDB_strict_split/shoulder_pain/openface_au_288
